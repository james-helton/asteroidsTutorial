<!doctype html>
<html>
	<head>
		<title>Exercise 7: Asteroid Animation</title>
		<link rel="stylesheet" href="styles/styles.css" />
		<script src="js/drawGrid.js"></script>
		<script src="e7/drawAsteroid.js"></script>
	</head>
	<body>
		<h1>Animation</h1>
		<canvas id='asteroids' width='300' height='300'></canvas>
		<label>FPS:</label>
		<input id='fps' type='text' />

		<script>
			let context = document.getElementById('asteroids').getContext('2d');

			var a = {
				shape: generateAsteroidShape(24),
				radius: 50,
				noise: 0.2,

				x: context.canvas.width * Math.random(),
				y: context.canvas.height * Math.random(),
				angle: 0,

				xSpeed: context.canvas.width * (Math.random() - 0.5),
				ySpeed: context.canvas.height * (Math.random() - 0.5),
				rotSpeed: 2 * Math.PI * (Math.random() - 0.5),				
			}

			let previous, elapsed;

			const draw = (ctx, guide) => {
				if(guide) {drawGrid(ctx);}
				drawAsteroid(
					ctx,
					{
						x: a.x,
						y: a.y,
						r: a.radius,
						a: a.angle,
						noise: a.noise,
						shape: a.shape,
						guide: guide,
					}
				);
			};

			const update = (elapsed) => {
				document.getElementById('fps').value = (1/elapsed);
				if(a.x - a.radius + elapsed * a.xSpeed > context.canvas.width) {a.x = -a.radius;}
				if(a.x + a.radius + elapsed * a.xSpeed < 0) {a.x = context.canvas.width + a.radius;}
				if(a.y - a.radius + elapsed * a.ySpeed > context.canvas.height) {a.y = -a.radius;}
				if(a.y + a.radius + elapsed * a.ySpeed < 0) {a.y = context.canvas.height + a.radius;}
				a.x += elapsed * a.xSpeed;
				a.y += elapsed * a.ySpeed;
				a.angle = (a.angle + elapsed * a.rotSpeed) % (2 * Math.PI);
			};

			const frame = (timestamp) => {
				context.clearRect(0, 0, context.canvas.width, context.canvas.height);
				if(!previous) previous = timestamp;
				elapsed = timestamp - previous;
				update(elapsed / 1000);
				draw(context, true);
				previous = timestamp;
				window.requestAnimationFrame(frame);
			};

			window.requestAnimationFrame(frame);
		</script>
	</body>
</html>